<nav>
    <div class="nav-wrapper grey darken-4">
        <div class="row">
            <div class="col s1">
                <a href="#" class="brand-logo">
                    <div>QB</div>
                </a>
            </div>
            <div class="col s6 offset-s1">
                <nav>
                    <div class="nav-wrapper grey darken-3">
                        <form>
                            <div class="input-field">
                                <input id="search" placeholder="Search..." type="search" ng-keypress="myFunct($event)" ng-model="search" required>
                                <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                                <i class="material-icons">close</i>
                            </div>
                        </form>
                    </div>
                </nav>
            </div>
            <div class="col s4">
                <ul>
                    <li>
                        <a ng-click="getSentRequests(); openMineModal();" class="modal-trigger btn-floating waves-effect waves-light btn hoverable tooltipped" data-position="down" data-delay="50" data-tooltip="Requests you have sent"><i class = "material-icons">library_add</i></a>
                        <!-- My requests -->
                    </li>
                    <li>
                        <a ng-click="getUserRequests(); openOtherModal();" class="modal-trigger btn-floating waves-effect waves-light btn tooltipped" data-position="down" data-delay="50" data-tooltip="Requests others have sent you"><i class = "material-icons">person_add</i></a>
                        <!-- other requests -->
                    </li>
                    <li>
                        <a ng-click="getBorrowedBooks(); openBorrowedModal();" class="modal-trigger btn-floating waves-effect waves-light btn hoverable tooltipped" data-position="down" data-delay="50" data-tooltip="Status of books you have borrowed"><i class = "material-icons">assignment_return</i></a>
                        <!-- Status of books borrowed and option to return books -->
                    </li>
                    <li>
                        <a ng-click="getLentBooksStatus(); openLentModal();" class="modal-trigger btn-floating waves-effect waves-light btn hoverable tooltipped" data-position="down" data-delay="50" data-tooltip="Status of your books"><i class = "material-icons">library_books</i></a>
                        <!-- Status of your books -->
                    </li>
                    <li>
                        <a ng-click="openUser();" class="btn-floating waves-effect waves-light btn hoverable tooltipped" data-position="down" data-delay="50" data-tooltip="Your profile"><i class = "material-icons">person</i></a>
                        <!-- My requests -->
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<script type="text/javascript" src="">
    document.getElementsByTagName('body')[0].style = "";
</script>
<div class="spinner" ng-show="loading">
    <link rel="stylesheet" type="text/css" href="css/loading.css" />
    <div id="loader" bgcolor="#212121">
        <img id="dot" class="dots_r" src="Images/loading/dot.svg" />
        <img id="dot1" class="dots_r" src="Images/loading/dot1.svg" />
        <img id="dot2" class="dots_r" src="Images/loading/dot2.svg" />
        <img id="dot3" class="dots_r" src="Images/loading/dot3.svg" />
        <img id="dot4" class="dots_r" src="Images/loading/dot4.svg" />
        <img id="dot5" class="dots_r" src="Images/loading/dot5.svg" />
        <img id="dot6" class="dots_r" src="Images/loading/dot6.svg" />

        <img id="dot7" class="dots_l" src="Images/loading/dot7.svg" />
        <img id="dot8" class="dots_l" src="Images/loading/dot8.svg" />
        <img id="dot9" class="dots_l" src="Images/loading/dot9.svg" />
        <img id="dot10" class="dots_l" src="Images/loading/dot10.svg" />
        <img id="dot11" class="dots_l" src="Images/loading/dot11.svg" />
        <img id="dot12" class="dots_l" src="Images/loading/dot12.svg" />
        <img id="dot13" class="dots_l" src="Images/loading/dot13.svg" />
        <img id="book" src="Images/loading/book.png" />
    </div>
</div>

<div class="section grey lighten-2" ng-show="page">
    <div ng-switch on="view">
        <div ng-switch-when="books">
            <div class="container">
                <div ng-repeat="book in books">
                    <div class="row">
                        <div class="col s6 offset-s3">
                            <div class="card">
                                <div class="card-image waves-effect waves-block waves-light">
                                    <img class="activator" ng-src="{{book.image}}">
                                </div>
                                <div class="card-content">
                                    <span class="card-title activator grey-text text-darken-4"><a href = "" ng-click = "openBook(book)">{{book.bookname}}</a><i class="material-icons right">more_vert</i></span>
                                    <p>Author: <a href = "" ng-click="openAuthor(book.author)">{{book.author}}</a>, {{book.year}}</p>
                                    <p>Genre: <a href = "" ng-click="openGenre(book.genre)">{{book.genre}}</a></p>
                                    <p>Owned By: <a href = "" ng-click="openUser(book)">{{book.username}}</a></p>
                                    <p>
                                        <!--   <input id="lenderId" type="hidden" ng-model="llenderId" value="{{book.uuid}}"> 
                                <input id="bookId" type="hidden" ng-model="lbookId" value="{{book.ubid}}"> -->
                                        <a ng-click="borrow(book)" id="borrowBtn" class="waves-effect waves-teal btn orange accent-4">Borrow this Book</a>

                                    </p>
                                </div>
                                <div class="card-reveal">
                                    <span class="card-title grey-text text-darken-4">{{book.bookname}},{{book.year}}, By {{book.author}}.Genre: {{book.genre}}<i class="material-icons right">close</i></span>
                                    <p>{{book.description}}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div ng-switch-when="search">
            <div class="section grey lighten-2">
                <div class="container">
                    <div class="row">
                        <div class="col s8 offset-s2">
                            <ul class="collection">
                                <div ng-repeat="book in books">
                                    <li class="collection-item avatar">
                                        <img src="Images/books.jpeg" alt="" class="circle">
                                        <span class="title"><a href="#">{{book.item.title}}, {{book.item.year}}</a></span>
                                        <p>Written by :<a href="" ng-click="openAuthor(book.item.author)">{{book.item.author}}</a></p>
                                        <p>Genre : <a href="" ng-click="openGenre(book.item.genre)">{{book.item.genre}}</a></p>
                                        <a href="#!" class="secondary-content"><i class="material-icons">grade</i></a>
                                    </li>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fixed-action-btn left-align" style="left: 23px; right: auto;">
        <a ng-click="addBook()" class="waves-effect waves-light btn btn-large hoverable btn-floating">
        <i class = "material-icons">library_add</i>
     </a>
    </div>
    <div id="modal1" class="modal">
        <div class="modal-content" ng-cloak>
            <div ng-show="sentrequest.length == 0">
                <div class="card">
                    <div class="card-title center-align">You have not sent any requests</div>
                </div>
            </div>
            <div ng-show="sentrequests.length > 0">
                <div ng-repeat="request in sentrequests">
                    <div class="card">
                        <div class="card-title center-align">You have sent a request for {{request.Book}} to {{request.Lender}}</div>
                        <div class="card-content center-align" ng-show="request.Status == 0">
                            <a class="btn waves-effect hoverable grey">{{request.Lender}} has not yet responded</a>
                        </div>
                        <div class="card-content center-align" ng-show="request.Status == 1">
                            <a class="btn waves-effect hoverable">{{request.Lender}} has accepted your request</a>
                        </div>
                        <div class="card-content center-align" ng-show="request.Status == 2">
                            <a class="btn waves-effect hoverable red">{{request.Lender}} has declined your request</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal2" class="modal">
        <div class="modal-content">
            <div ng-show="requests.length == 0">
                <div class="card">
                    <div class="card-title center-align">You have not received any requests</div>
                </div>
            </div>
            <div ng-show="requests.length > 0">
                <div ng-repeat="request in requests">
                    <div class="card">
                        <div class="card-title center-align">You have a new request for your book {{request.Book}} by {{request.Borrower}}</div>
                        <div ng-show="replysuccess(request.URID)">
                            <div class="card-content center-align">
                                <div class="row">
                                    <div class="col s8 offset-s2">
                                        <a class="waves-effect waves-light btn grey">You have responded to this request</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-show="!replysuccess(request.URID)">
                            <div class="card-content">
                                <div class="row">
                                    <div class="col s3 offset-s1">
                                        <a ng-click="ReplyUserRequests(1, request)" class="waves-effect waves-light btn">Accept</a>
                                    </div>
                                    <div class="col s3 offset-s3">
                                        <a ng-click="ReplyUserRequests(2, request)" class="waves-effect waves-light btn">Decline</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal3" class="modal">
        <div class="modal-content">
            <div ng-show="borrowedbooks.length == 0">
                <div class="card">
                    <div class="card-title center-align">You have not borrowed any books</div>
                </div>
            </div>
            <div ng-show="borrowedbooks.length > 0">
                <div ng-repeat="book in borrowedbooks">
                    <div class="card">
                        <div class="card-title center-align">You borrowed {{book.Bookname}} from <br> {{book.Lender}} on {{book.borrowDate}}</div>
                        <div ng-show="returnreqsuccess(book.UBOID)">
                            <div class="card-content center-align">
                                <div class="row">
                                    <div class="col s9 offset-s1">
                                        <a class="waves-effect waves-light btn grey">You have requested to return this book</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-show="!returnreqsuccess(book.UBOID)">
                            <div class="card-content center-align" ng-show="book.Outstanding == 1 && book.ReturnRequest == 0">
                                <a ng-click="returnBorrowedBook(book)" class="btn waves-effect hoverable">Return book</a>
                            </div>
                            <div class="card-content center-align" ng-show="book.Outstanding == 1 && book.ReturnRequest == 1">
                                <a class="btn waves-effect hoverable">{{book.Lender}} has yet to reply to your request to return the book</a>
                            </div>
                            <div class="card-content center-align" ng-show="book.Outstanding == 0">
                                <a class="btn waves-effect hoverable grey">You have already returned this book</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal4" class="modal">
        <div class="modal-content">
            <div ng-show="lentbooks.length == 0">
                <div class="card">
                    <div class="card-title center-align">You have not lent any books</div>
                </div>
            </div>
            <div ng-show="lentbooks.length > 0">
                <div ng-repeat="book in lentbooks">
                    <div class="card">
                        <div class="card-title center-align">You lent {{book.Bookname}} to <br> {{book.Borrower}} on {{book.borrowDate}}</div>
                        <div ng-show="takebacksuccess(book.UBOID)">
                            <div class="card-content center-align">
                                <div class="row">
                                    <div class="col s9 offset-s1">
                                        <a class="waves-effect waves-light btn grey">You have accepted to take back the book</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-show="!takebacksuccess(book.UBOID)">
                            <div class="card-content center-align" ng-show="book.Outstanding == 1 && book.ReturnRequest == 0">
                                <a class="btn waves-effect hoverable">{{book.Borrower}} has yet to return this book</a>
                            </div>
                            <div class="card-content center-align" ng-show="book.Outstanding == 1 && book.ReturnRequest == 1">
                                <a class="btn waves-effect hoverable">{{book.Borrower}} has requested you to take back your book</a>
                                <a ng-click="takeBackBook(book)" class="btn waves-effect hoverable blue">Take back book</a>
                            </div>
                            <div class="card-content center-align" ng-show="book.Outstanding == 0">
                                <a class="btn waves-effect hoverable grey">You have taken this book back</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 